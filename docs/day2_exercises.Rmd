---
title: '<span class="en">Day 2: Exercises</span><span class="de">Tag 2: √úbungen</span>'
subtitle: '<span class="en">Advanced Analysis & Research Project</span><span class="de">Fortgeschrittene Analyse & Forschungsprojekt</span>'
author: '<span class="en">Fill in the blanks!</span><span class="de">F√ºlle die L√ºcken aus!</span>'
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    self_contained: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE, message = FALSE, warning = FALSE)
```

```{=html}
<style>
/* ========== PLAYFUL WORKSHOP THEME ========== */

body {
 font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
 line-height: 1.7;
 background-color: #fafffe;
}

h1 {
 color: #2E7D32 !important;
 border-bottom: 3px solid #4CAF50;
 padding-bottom: 10px;
}

h2 {
 color: #388E3C !important;
 margin-top: 2em;
}

h3 {
 color: #43A047 !important;
}

h4 {
 color: #66BB6A !important;
 border-left: 4px solid #4CAF50;
 padding-left: 10px;
}

/* Code blocks with copy button support */
pre {
 background-color: #f5f5f5 !important;
 border-left: 4px solid #4CAF50 !important;
 padding: 15px;
 padding-top: 35px;
 border-radius: 8px;
 overflow-x: auto;
 position: relative !important;
}

code {
 background-color: #E8F5E9;
 padding: 2px 6px;
 border-radius: 4px;
 color: #2E7D32;
}

pre code {
 background-color: transparent;
 padding: 0;
}

/* Copy button styling */
.copy-btn {
 position: absolute !important;
 top: 8px !important;
 right: 8px !important;
 padding: 4px 12px;
 font-size: 12px;
 background: #4CAF50;
 color: white;
 border: none;
 border-radius: 4px;
 cursor: pointer;
 opacity: 0;
 transition: opacity 0.2s, background 0.2s;
 z-index: 100;
}

pre:hover .copy-btn {
 opacity: 1;
}

.copy-btn:hover {
 background: #2E7D32;
}

.copy-btn.copied {
 background: #1976D2;
}

blockquote {
 border-left: 4px solid #FF9800;
 background-color: #FFF8E1;
 padding: 15px 20px;
 margin: 1em 0;
 border-radius: 0 8px 8px 0;
}

hr {
 border: none;
 height: 3px;
 background: linear-gradient(to right, #4CAF50, #81C784, #C8E6C9, #81C784, #4CAF50);
 margin: 2em 0;
 border-radius: 2px;
}

.tocify {
 border: none !important;
 border-radius: 12px !important;
 background-color: #f1f8e9 !important;
 box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.tocify-item.active, .tocify-item.active:hover {
 background-color: #4CAF50 !important;
 color: white !important;
}

/* Exercise hint */
.hint {
 background-color: #E3F2FD;
 border: 1px solid #1976D2;
 border-radius: 8px;
 padding: 10px 15px;
 margin: 1em 0;
 font-size: 0.9em;
}

.hint::before {
 content: "üí° ";
}

/* Explore box */
.explore {
 background-color: #FFF3E0;
 border: 1px solid #FF9800;
 border-radius: 8px;
 padding: 10px 15px;
 margin: 1em 0;
 font-size: 0.9em;
}

.explore::before {
 content: "üîç ";
}

/* Debug box */
.debug {
 background-color: #FFEBEE;
 border: 1px solid #F44336;
 border-radius: 8px;
 padding: 10px 15px;
 margin: 1em 0;
 font-size: 0.9em;
}

.debug::before {
 content: "üêõ ";
}

/* Predict box */
.predict {
 background-color: #E8F5E9;
 border: 1px solid #4CAF50;
 border-radius: 8px;
 padding: 10px 15px;
 margin: 1em 0;
 font-size: 0.9em;
}

.predict::before {
 content: "ü§î ";
}

/* ========== LANGUAGE TOGGLE ========== */

.lang-toggle {
 position: fixed;
 top: 10px;
 right: 20px;
 z-index: 9999;
 background: linear-gradient(135deg, #2E7D32, #4CAF50);
 padding: 8px 12px;
 border-radius: 25px;
 box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
}

.lang-toggle button {
 background: transparent;
 border: none;
 color: #fff;
 padding: 6px 14px;
 cursor: pointer;
 font-weight: bold;
 border-radius: 20px;
 transition: all 0.3s;
 font-size: 14px;
}

.lang-toggle button.active {
 background: white;
 color: #2E7D32;
}

.lang-toggle button:hover:not(.active) {
 background: rgba(255,255,255,0.2);
}

.de { display: none; }
.en { display: inline; }

body.lang-de .de { display: inline; }
body.lang-de .en { display: none; }

div.de, p.de, li.de, h1.de, h2.de, h3.de, h4.de, section.de { display: none; }
div.en, p.en, li.en, h1.en, h2.en, h3.en, h4.en, section.en { display: block; }

body.lang-de div.de, body.lang-de p.de, body.lang-de li.de,
body.lang-de h1.de, body.lang-de h2.de, body.lang-de h3.de,
body.lang-de h4.de, body.lang-de section.de { display: block; }

body.lang-de div.en, body.lang-de p.en, body.lang-de li.en,
body.lang-de h1.en, body.lang-de h2.en, body.lang-de h3.en,
body.lang-de h4.en, body.lang-de section.en { display: none; }

body.lang-de #TOC .en { display: none; }
body.lang-de #TOC .de { display: inline; }
#TOC .de { display: none; }
#TOC .en { display: inline; }

@media print {
 .tocify, .lang-toggle, .copy-btn { display: none; }
}

/* ========== MOBILE RESPONSIVE ========== */
@media (max-width: 768px) {
  body { font-size: 14px; line-height: 1.5; }
  h1 { font-size: 1.5rem; }
  h2 { font-size: 1.3rem; }
  h3 { font-size: 1.1rem; }
  .lang-toggle { top: 5px; right: 10px; padding: 5px 8px; }
  .lang-toggle button { padding: 4px 10px; font-size: 12px; }
  table { font-size: 12px; display: block; overflow-x: auto; white-space: nowrap; }
  th, td { padding: 6px 8px; }
  blockquote { padding: 10px 15px; margin: 0.5em 0; }
  pre { font-size: 11px; padding: 10px; }
  code { font-size: 11px; }
  img, .figure img { max-width: 100%; height: auto; }
  .code-exercise { padding: 10px; }
}
</style>
```

```{=html}
<script>
$(document).ready(function() {
  // Language toggle
  var toggle = $('<div class="lang-toggle"><button id="btn-en" class="active">EN</button><button id="btn-de">DE</button></div>');
  $('body').append(toggle);

  var savedLang = localStorage.getItem('workshop-lang');
  var browserLang = navigator.language.substring(0, 2);
  var defaultLang = savedLang || (browserLang === 'de' ? 'de' : 'en');

  function setLanguage(lang) {
    $('body').removeClass('lang-en lang-de').addClass('lang-' + lang);
    $('#btn-en').toggleClass('active', lang === 'en');
    $('#btn-de').toggleClass('active', lang === 'de');
    localStorage.setItem('workshop-lang', lang);
  }

  if (defaultLang === 'de') {
    setLanguage('de');
  }

  $('#btn-en').click(function() { setLanguage('en'); });
  $('#btn-de').click(function() { setLanguage('de'); });

  // Copy button for code blocks
  $('pre').each(function() {
    var pre = $(this);
    var btn = $('<button class="copy-btn">Copy</button>');

    btn.click(function() {
      var code = pre.find('code');
      var text = code.length ? code.text() : pre.text();

      function showSuccess() {
        btn.text('Copied!').addClass('copied');
        setTimeout(function() {
          btn.text('Copy').removeClass('copied');
        }, 2000);
      }

      function fallbackCopy() {
        var textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showSuccess();
        } catch(e) {
          btn.text('Failed');
        }
        document.body.removeChild(textarea);
      }

      // Use clipboard API if available and in secure context, else fallback
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(showSuccess).catch(fallbackCopy);
      } else {
        fallbackCopy();
      }
    });

    pre.css('position', 'relative').append(btn);
  });
});
</script>
```

---

# <span class="en">Welcome to Day 2!</span><span class="de">Willkommen zu Tag 2!</span>

<div class="en">

Yesterday you went from learning basic R to building your first native vs alien accumulation curve on real Austrian data. Today we'll:

1. **Quantify uncertainty** - Run from multiple starting points to see how much variation exists
2. **Compare patterns quantitatively** - Saturation speeds, slope ratios
3. **Create publication-quality figures** with confidence intervals
4. **Draw scientific conclusions** about native vs alien distributions

First, let's reload our data and functions from Day 1.

</div>

<div class="de">

Gestern hast du von R-Grundlagen bis zur ersten heimisch vs alien Akkumulationskurve mit echten √∂sterreichischen Daten gelernt. Heute werden wir:

1. **Unsicherheit quantifizieren** - Von mehreren Startpunkten starten um Variation zu sehen
2. **Muster quantitativ vergleichen** - S√§ttigungsgeschwindigkeiten, Steigungsverh√§ltnisse
3. **Publikationsreife Abbildungen erstellen** mit Konfidenzintervallen
4. **Wissenschaftliche Schlussfolgerungen** √ºber heimische vs Alien-Verteilungen ziehen

Zuerst laden wir unsere Daten und Funktionen von Tag 1.

</div>

---

# <span class="en">Part 5: Setup - Reload Day 1 Functions</span><span class="de">Teil 5: Setup - Tag 1 Funktionen neu laden</span>

## <span class="en">Load Data and Define Functions</span><span class="de">Daten laden und Funktionen definieren</span>

```{r}
# Load packages
# Pakete laden
library(dplyr)
library(ggplot2)

# Load data
# Daten laden
header <- read.csv("../data/austria_header.csv")
species <- read.csv("../data/austria_species.csv")

# Verify data loaded
# √úberpr√ºfe dass Daten geladen sind
cat("Header:", nrow(header), "plots\n")
cat("Species:", nrow(species), "records\n")
cat("Unique species:", length(unique(species$WFO_TAXON)), "\n")
```

```{r}
# Distance function
# Distanzfunktion
calc_distance <- function(x1, y1, x2, y2) {
  sqrt((x2 - x1)^2 + (y2 - y1)^2)
}

# Nearest-neighbour walk function
# Nearest-Neighbour-Walk-Funktion
nn_walk <- function(header_data, start_idx = NULL) {
  n <- nrow(header_data)
  if (is.null(start_idx)) {
    start_idx <- sample(1:n, 1)
  }

  visited <- rep(FALSE, n)
  visit_order <- numeric(n)
  current <- start_idx

  for (i in 1:n) {
    visited[current] <- TRUE
    visit_order[i] <- header_data$PlotObservationID[current]

    if (i < n) {
      distances <- calc_distance(
        header_data$Longitude[current],
        header_data$Latitude[current],
        header_data$Longitude,
        header_data$Latitude
      )
      distances[visited] <- Inf
      current <- which.min(distances)
    }
  }

  return(visit_order)
}

# Accumulation function
# Akkumulationsfunktion
build_accumulation <- function(species_data, plot_order, status_filter = NULL) {
  if (!is.null(status_filter)) {
    species_data <- species_data %>% filter(STATUS == status_filter)
  }

  found <- c()
  accum <- numeric(length(plot_order))

  for (i in seq_along(plot_order)) {
    plot_spp <- species_data %>%
      filter(PlotObservationID == plot_order[i]) %>%
      pull(WFO_TAXON) %>%
      unique()

    new_spp <- setdiff(plot_spp, found)
    found <- c(found, new_spp)
    accum[i] <- length(found)
  }

  return(accum)
}

# Saturation point function
# S√§ttigungspunkt-Funktion
find_saturation <- function(curve, threshold = 0.8) {
  total <- max(curve)
  target <- total * threshold
  which(curve >= target)[1]
}

cat("All functions loaded!\n")
```

<div class="hint">
<span class="en">Run both code blocks above to set up for today's exercises. If you get errors, make sure the data files are in the correct location (`../data/`).</span>
<span class="de">F√ºhre beide Code-Bl√∂cke oben aus um dich f√ºr die heutigen √úbungen vorzubereiten. Bei Fehlern stelle sicher dass die Datendateien am richtigen Ort sind (`../data/`).</span>
</div>

---

# <span class="en">Part 6: Measuring Uncertainty</span><span class="de">Teil 6: Unsicherheit messen</span>

<div class="en">

Yesterday we ran from a single starting point. But the accumulation curve depends on where we start - different paths through the landscape give different curves. Today we'll run from many starting points and quantify this variation.

</div>

<div class="de">

Gestern starteten wir von einem einzigen Punkt. Aber die Akkumulationskurve h√§ngt davon ab wo wir starten - verschiedene Wege durch die Landschaft geben verschiedene Kurven. Heute starten wir von vielen Punkten und quantifizieren diese Variation.

</div>

---

## <span class="en">Exercise 16: Multiple Seeds - Measuring Uncertainty</span><span class="de">√úbung 16: Mehrere Seeds - Unsicherheit messen</span>

### <span class="en">16a: Run from multiple starting points</span><span class="de">16a: Von mehreren Startpunkten starten</span>

```{r}
# 16a: The starting point matters - let's quantify how much
# 16a: Der Startpunkt ist wichtig - quantifizieren wir wie sehr

n_seeds <- 20  # Number of different starting points
sample_size <- 150

set.seed(42)
sample_ids <- sample(unique(header$PlotObservationID), sample_size)
sample_header <- header %>% filter(PlotObservationID %in% sample_ids)
sample_species <- species %>% filter(PlotObservationID %in% sample_ids)

# Storage for results
# Speicher f√ºr Ergebnisse
native_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)
alien_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)

# Run from each seed
# Starte von jedem Seed
cat("Running", n_seeds, "seeds...\n")
for (seed in 1:n_seeds) {
  nn_order <- nn_walk(sample_header, start_idx = seed)
  native_runs[seed, ] <- build_accumulation(sample_species, nn_order, "____")
  alien_runs[seed, ] <- build_accumulation(sample_species, nn_order, "____")

  if (seed %% 5 == 0) cat("  Completed seed", seed, "\n")
}

cat("Done!\n")
```

### <span class="en">16b: Calculate summary statistics</span><span class="de">16b: Zusammenfassende Statistiken berechnen</span>

```{r}
# 16b: Mean and confidence intervals
# 16b: Mittelwert und Konfidenzintervalle

native_mean <- apply(native_runs, 2, ____)
native_lower <- apply(native_runs, 2, function(x) quantile(x, 0.025))
native_upper <- apply(native_runs, 2, function(x) quantile(x, ____))

alien_mean <- apply(alien_runs, 2, mean)
alien_lower <- apply(alien_runs, 2, function(x) quantile(x, ____))
alien_upper <- apply(alien_runs, 2, function(x) quantile(x, 0.975))

# Coefficient of variation at midpoint
# Variationskoeffizient am Mittelpunkt
midpoint <- sample_size %/% 2
native_cv <- round(100 * sd(native_runs[, midpoint]) / mean(native_runs[, midpoint]), 1)
alien_cv <- round(100 * sd(alien_runs[, midpoint]) / mean(alien_runs[, midpoint]), 1)

print(paste("Variation at", midpoint, "plots:"))
print(paste("  Native CV:", native_cv, "%"))
print(paste("  Alien CV:", alien_cv, "%"))
```

### <span class="en">16c: Plot with uncertainty bands</span><span class="de">16c: Plotte mit Unsicherheitsb√§ndern</span>

```{r}
# 16c: Publication-quality plot
# 16c: Publikationsreifer Plot

summary_data <- data.frame(
  plots = rep(1:sample_size, 2),
  mean = c(native_mean, alien_mean),
  lower = c(native_lower, alien_lower),
  upper = c(native_upper, alien_upper),
  status = rep(c("Native", "Alien"), each = sample_size)
)

ggplot(summary_data, aes(x = plots)) +
  geom_ribbon(aes(ymin = lower, ymax = upper, fill = status), alpha = ____) +
  geom_line(aes(y = mean, color = status), linewidth = 1.2) +
  scale_color_manual(values = c("Native" = "darkgreen", "Alien" = "red")) +
  scale_fill_manual(values = c("Native" = "darkgreen", "Alien" = "red")) +
  labs(
    title = "Species Accumulation with Uncertainty",
    subtitle = paste(n_seeds, "starting points - shaded area = 95% CI"),
    x = "Plots Sampled (Nearest-Neighbour Order)",
    y = "Cumulative Species",
    color = "", fill = ""
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

---

## <span class="en">Exercise 17: Comparing Curve Shapes Quantitatively</span><span class="de">√úbung 17: Kurvenformen quantitativ vergleichen</span>

### <span class="en">17a: Saturation point comparison</span><span class="de">17a: S√§ttigungspunkt-Vergleich</span>

```{r}
# 17a: At what point do we reach 80% of species?
# 17a: Bei welchem Punkt erreichen wir 80% der Arten?

native_sat <- apply(native_runs, 1, find_saturation, threshold = 0.8)
alien_sat <- apply(alien_runs, 1, find_saturation, threshold = ____)

# Convert to percentage of total plots
# In Prozent der Gesamtplots umwandeln
native_sat_pct <- 100 * native_sat / sample_size
alien_sat_pct <- 100 * alien_sat / sample_size

print("Plots needed to reach 80% of species:")
print(paste("  Native:", round(mean(native_sat_pct)), "% (SD:", round(sd(native_sat_pct), 1), ")"))
print(paste("  Alien:", round(mean(alien_sat_pct)), "% (SD:", round(sd(alien_sat_pct), 1), ")"))

# Box plot comparison
# Boxplot-Vergleich
sat_data <- data.frame(
  saturation_pct = c(native_sat_pct, alien_sat_pct),
  status = rep(c("Native", "Alien"), each = n_seeds)
)

ggplot(sat_data, aes(x = status, y = saturation_pct, fill = status)) +
  geom_boxplot() +
  scale_fill_manual(values = c("Native" = "____", "Alien" = "____")) +
  labs(
    title = "Saturation Speed Comparison",
    subtitle = "% of plots needed to find 80% of species",
    y = "% of Plots Needed",
    x = ""
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

### <span class="en">17b: Slope ratio (early vs late)</span><span class="de">17b: Steigungsverh√§ltnis (fr√ºh vs sp√§t)</span>

```{r}
# 17b: Compare early vs late slopes
# 17b: Vergleiche fr√ºhe vs sp√§te Steigungen

# Steep start + flat end = species evenly distributed
# Steil am Anfang + flach am Ende = Arten gleichm√§√üig verteilt
# Steady throughout = species patchy
# Stetig durchgehend = Arten fleckenhaft

calc_slope_ratio <- function(curve) {
  n <- length(curve)

  # Early slope (first 20%)
  # Fr√ºhe Steigung (erste 20%)
  early_end <- round(n * 0.2)
  early_slope <- (curve[early_end] - curve[1]) / early_end

  # Late slope (last 20%)
  # Sp√§te Steigung (letzte 20%)
  late_start <- round(n * 0.8)
  late_slope <- (curve[n] - curve[late_start]) / (n - late_start)

  if (late_slope > 0) {
    return(early_slope / late_slope)
  } else {
    return(NA)
  }
}

native_ratios <- apply(native_runs, 1, calc_slope_ratio)
alien_ratios <- apply(alien_runs, 1, ____)

print("Slope ratio (early/late) - higher = faster saturation:")
print(paste("  Native:", round(mean(native_ratios, na.rm = TRUE), 1)))
print(paste("  Alien:", round(mean(alien_ratios, na.rm = TRUE), 1)))
```

---

## <span class="en">Exercise 18: Geographic Patterns</span><span class="de">√úbung 18: Geografische Muster</span>

### <span class="en">18a: Does starting location affect results?</span><span class="de">18a: Beeinflusst der Startort die Ergebnisse?</span>

```{r}
# 18a: Map how starting location affects alien detection
# 18a: Kartiere wie der Startort die Alien-Erkennung beeinflusst

n_map_seeds <- 30
checkpoint <- 75  # Check alien ratio after this many plots

seed_results <- data.frame(
  seed_idx = 1:n_map_seeds,
  seed_lon = numeric(n_map_seeds),
  seed_lat = numeric(n_map_seeds),
  native_count = numeric(n_map_seeds),
  alien_count = numeric(n_map_seeds)
)

for (i in 1:n_map_seeds) {
  # Record seed location
  # Erfasse Seed-Standort
  seed_results$seed_lon[i] <- sample_header$Longitude[i]
  seed_results$seed_lat[i] <- sample_header$Latitude[i]

  # Run from this seed
  # Starte von diesem Seed
  nn_order <- nn_walk(sample_header, start_idx = i)

  # Get counts at checkpoint
  # Hole Z√§hlungen am Checkpoint
  native_curve <- build_accumulation(sample_species, nn_order, "native")
  alien_curve <- build_accumulation(sample_species, nn_order, "neo")

  seed_results$native_count[i] <- native_curve[min(checkpoint, length(native_curve))]
  seed_results$alien_count[i] <- alien_curve[min(checkpoint, length(alien_curve))]
}

# Calculate alien proportion
# Berechne Alien-Anteil
seed_results$alien_prop <- seed_results$alien_count /
  (seed_results$native_count + seed_results$____)

# Map it
# Kartiere es
ggplot(seed_results, aes(x = seed_lon, y = seed_lat, color = alien_prop)) +
  geom_point(size = 3) +
  scale_color_gradient2(
    low = "darkgreen",
    mid = "yellow",
    high = "red",
    midpoint = mean(seed_results$alien_prop),
    name = "Alien\nproportion"
  ) +
  coord_quickmap() +
  labs(
    title = "How Starting Location Affects Alien Detection",
    subtitle = paste("Alien proportion after", checkpoint, "plots"),
    x = "Longitude",
    y = "Latitude"
  ) +
  theme_minimal()
```

---

# <span class="en">Part 7: Complete Research Analysis</span><span class="de">Teil 7: Vollst√§ndige Forschungsanalyse</span>

## <span class="en">Exercise 19: Full Analysis</span><span class="de">√úbung 19: Vollst√§ndige Analyse</span>

### <span class="en">19a: Run the complete analysis</span><span class="de">19a: F√ºhre die komplette Analyse aus</span>

```{r}
# 19a: Production run with more samples
# 19a: Produktionslauf mit mehr Stichproben

# Parameters
# Parameter
n_seeds <- 30
sample_size <- 250

set.seed(2024)
sample_ids <- sample(unique(header$PlotObservationID), sample_size)
sample_header <- header %>% filter(PlotObservationID %in% sample_ids)
sample_species <- species %>% filter(PlotObservationID %in% sample_ids)

# Run analysis
# F√ºhre Analyse aus
native_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)
alien_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)

cat("Running full analysis...\n")
for (seed in 1:n_seeds) {
  nn_order <- nn_walk(sample_header, start_idx = seed)
  native_runs[seed, ] <- build_accumulation(sample_species, nn_order, "native")
  alien_runs[seed, ] <- build_accumulation(sample_species, nn_order, "neo")
  if (seed %% 10 == 0) cat("  Completed", seed, "of", n_seeds, "\n")
}
cat("Done!\n")

# Calculate summaries
# Berechne Zusammenfassungen
results <- data.frame(
  plots = rep(1:sample_size, 2),
  mean = c(apply(native_runs, 2, mean), apply(alien_runs, 2, mean)),
  lower = c(apply(native_runs, 2, function(x) quantile(x, 0.025)),
            apply(alien_runs, 2, function(x) quantile(x, 0.025))),
  upper = c(apply(native_runs, 2, function(x) quantile(x, 0.975)),
            apply(alien_runs, 2, function(x) quantile(x, 0.975))),
  status = rep(c("Native", "Alien"), each = sample_size)
)
```

### <span class="en">19b: Create final publication plot</span><span class="de">19b: Erstelle finalen Publikationsplot</span>

```{r}
# 19b: Publication-ready figure
# 19b: Publikationsreife Abbildung

final_plot <- ggplot(results, aes(x = plots)) +
  geom_ribbon(aes(ymin = lower, ymax = upper, fill = status), alpha = 0.25) +
  geom_line(aes(y = mean, color = status), linewidth = 1.3) +
  scale_color_manual(
    values = c("Native" = "#228B22", "Alien" = "#DC143C"),
    name = ""
  ) +
  scale_fill_manual(
    values = c("Native" = "#228B22", "Alien" = "#DC143C"),
    name = ""
  ) +
  labs(
    title = "Species Accumulation: Native vs Alien Plants",
    subtitle = paste0("Nearest-neighbour sampling from ", n_seeds,
                      " starting points (95% CI shown)"),
    x = "Number of Plots Sampled",
    y = "Cumulative Species Count",
    caption = "Data: Austrian vegetation plots"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = c(0.85, 0.2),
    legend.background = element_rect(fill = "white", color = "gray80"),
    plot.title = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )

print(final_plot)

# Save it (uncomment to run)
# Speichere es (entkommentieren zum Ausf√ºhren)
# ggsave("austria_accumulation_final.png", final_plot, width = 10, height = 7, dpi = 300)
```

---

## <span class="en">Exercise 20: Results Summary</span><span class="de">√úbung 20: Ergebniszusammenfassung</span>

```{r}
# 20: Final statistics report
# 20: Abschlie√üender Statistikbericht

cat("\n===== RESULTS SUMMARY =====\n\n")

# Species found
# Gefundene Arten
cat("Species found:\n")
cat("  Native:", round(mean(native_runs[, sample_size])),
    "(range:", min(native_runs[, sample_size]), "-", max(native_runs[, sample_size]), ")\n")
cat("  Alien:", round(mean(alien_runs[, sample_size])),
    "(range:", min(alien_runs[, sample_size]), "-", max(alien_runs[, sample_size]), ")\n\n")

# Saturation
# S√§ttigung
native_sat <- apply(native_runs, 1, find_saturation, threshold = 0.8)
alien_sat <- apply(alien_runs, 1, find_saturation, threshold = 0.8)

cat("Plots to reach 80% of species:\n")
cat("  Native:", round(mean(native_sat)), "plots (",
    round(100*mean(native_sat)/sample_size), "%)\n")
cat("  Alien:", round(mean(alien_sat)), "plots (",
    round(100*mean(alien_sat)/sample_size), "%)\n\n")

# Variation
# Variation
cat("Variation between starting points (CV at 100 plots):\n")
cat("  Native:", round(100 * sd(native_runs[,100]) / mean(native_runs[,100]), 1), "%\n")
cat("  Alien:", round(100 * sd(alien_runs[,100]) / mean(alien_runs[,100]), 1), "%\n\n")

# Conclusion
# Schlussfolgerung
cat("===== CONCLUSION =====\n")
if (mean(native_sat) < mean(alien_sat)) {
  cat("Native species saturate FASTER than aliens.\n")
  cat("This suggests natives are more evenly distributed,\n")
  cat("while aliens are more patchy/clustered.\n")
} else {
  cat("Aliens saturate FASTER than natives.\n")
  cat("This is unexpected - perhaps aliens are more widespread\n")
  cat("than hypothesized in this region.\n")
}
```

<blockquote>
<span class="en">**Final Discussion:**
1. Do the results support our hypothesis about natives saturating faster?
2. What does the variation between seeds tell us about alien distribution?
3. What would you investigate next? (Climate? Land use? Specific regions?)
</span>
<span class="de">**Abschlussdiskussion:**
1. Unterst√ºtzen die Ergebnisse unsere Hypothese dass Heimische schneller saturieren?
2. Was sagt uns die Variation zwischen Seeds √ºber die Alienverteilung?
3. Was w√ºrdest du als n√§chstes untersuchen? (Klima? Landnutzung? Bestimmte Regionen?)
</span>
</blockquote>

---

# <span class="en">Quick Reference</span><span class="de">Schnellreferenz</span>

<div class="en">

| Function | Purpose | Example |
|----------|---------|---------|
| `apply()` | Apply function to matrix | `apply(mat, 2, mean)` |
| `quantile()` | Get percentiles | `quantile(x, 0.975)` |
| `geom_ribbon()` | Add shaded band | `+ geom_ribbon(aes(ymin, ymax))` |
| `scale_color_manual()` | Custom colors | `+ scale_color_manual(values = c(...))` |
| `scale_color_gradient2()` | Diverging color scale | `+ scale_color_gradient2(...)` |
| `ggsave()` | Save plot to file | `ggsave("plot.png", width = 10)` |
| `theme()` | Customize plot appearance | `+ theme(legend.position = "bottom")` |
| `element_rect()` | Rectangle element for themes | `element_rect(fill = "white")` |
| `element_text()` | Text element for themes | `element_text(face = "bold")` |

</div>

<div class="de">

| Funktion | Zweck | Beispiel |
|----------|-------|----------|
| `apply()` | Funktion auf Matrix anwenden | `apply(mat, 2, mean)` |
| `quantile()` | Perzentile berechnen | `quantile(x, 0.975)` |
| `geom_ribbon()` | Schattiertes Band | `+ geom_ribbon(aes(ymin, ymax))` |
| `scale_color_manual()` | Eigene Farben | `+ scale_color_manual(values = c(...))` |
| `scale_color_gradient2()` | Divergierende Farbskala | `+ scale_color_gradient2(...)` |
| `ggsave()` | Plot in Datei speichern | `ggsave("plot.png", width = 10)` |
| `theme()` | Plot-Erscheinung anpassen | `+ theme(legend.position = "bottom")` |
| `element_rect()` | Rechteck-Element f√ºr Themes | `element_rect(fill = "white")` |
| `element_text()` | Text-Element f√ºr Themes | `element_text(face = "bold")` |

</div>
