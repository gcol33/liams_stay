---
title: '<span class="en">Day 2: Solutions</span><span class="de">Tag 2: Lösungen</span>'
subtitle: '<span class="en">Advanced Analysis & Research Project</span><span class="de">Fortgeschrittene Analyse & Forschungsprojekt</span>'
author: '<span class="en">Complete code with answers</span><span class="de">Vollständiger Code mit Antworten</span>'
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    self_contained: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE, message = FALSE, warning = FALSE)
```

```{=html}
<style>
/* ========== PLAYFUL WORKSHOP THEME ========== */

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.7;
  background-color: #fafffe;
}

h1 {
  color: #2E7D32 !important;
  border-bottom: 3px solid #4CAF50;
  padding-bottom: 10px;
}

h2 {
  color: #388E3C !important;
  margin-top: 2em;
}

h3 {
  color: #43A047 !important;
}

h4 {
  color: #66BB6A !important;
  border-left: 4px solid #4CAF50;
  padding-left: 10px;
}

pre {
  background-color: #f5f5f5 !important;
  border-left: 4px solid #4CAF50 !important;
  padding: 15px;
  padding-top: 35px;
  border-radius: 8px;
  overflow-x: auto;
  position: relative !important;
}

code {
  background-color: #E8F5E9;
  padding: 2px 6px;
  border-radius: 4px;
  color: #2E7D32;
}

pre code {
  background-color: transparent;
  padding: 0;
}

.copy-btn {
  position: absolute !important;
  top: 8px !important;
  right: 8px !important;
  padding: 4px 12px;
  font-size: 12px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s, background 0.2s;
  z-index: 100;
}

pre:hover .copy-btn {
  opacity: 1;
}

.copy-btn:hover {
  background: #2E7D32;
}

.copy-btn.copied {
  background: #1976D2;
}

blockquote {
  border-left: 4px solid #FF9800;
  background-color: #FFF8E1;
  padding: 15px 20px;
  margin: 1em 0;
  border-radius: 0 8px 8px 0;
}

hr {
  border: none;
  height: 3px;
  background: linear-gradient(to right, #4CAF50, #81C784, #C8E6C9, #81C784, #4CAF50);
  margin: 2em 0;
  border-radius: 2px;
}

.tocify {
  border: none !important;
  border-radius: 12px !important;
  background-color: #f1f8e9 !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.tocify-item.active, .tocify-item.active:hover {
  background-color: #4CAF50 !important;
  color: white !important;
}

.solution-notice {
  background-color: #FFEBEE;
  border: 2px solid #F44336;
  border-radius: 8px;
  padding: 15px;
  margin: 1em 0;
  text-align: center;
  font-weight: bold;
}

.recap-box {
  background-color: #E8F5E9;
  border: 2px solid #4CAF50;
  border-radius: 8px;
  padding: 15px;
  margin: 1em 0;
}

/* ========== LANGUAGE TOGGLE ========== */

.lang-toggle {
  position: fixed;
  top: 10px;
  right: 20px;
  z-index: 9999;
  background: linear-gradient(135deg, #2E7D32, #4CAF50);
  padding: 8px 12px;
  border-radius: 25px;
  box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
}

.lang-toggle button {
  background: transparent;
  border: none;
  color: #fff;
  padding: 6px 14px;
  cursor: pointer;
  font-weight: bold;
  border-radius: 20px;
  transition: all 0.3s;
  font-size: 14px;
}

.lang-toggle button.active {
  background: white;
  color: #2E7D32;
}

.lang-toggle button:hover:not(.active) {
  background: rgba(255,255,255,0.2);
}

.de { display: none; }
.en { display: inline; }

body.lang-de .de { display: inline; }
body.lang-de .en { display: none; }

div.de, p.de, li.de, h1.de, h2.de, h3.de, h4.de, section.de { display: none; }
div.en, p.en, li.en, h1.en, h2.en, h3.en, h4.en, section.en { display: block; }

body.lang-de div.de, body.lang-de p.de, body.lang-de li.de,
body.lang-de h1.de, body.lang-de h2.de, body.lang-de h3.de,
body.lang-de h4.de, body.lang-de section.de { display: block; }

body.lang-de div.en, body.lang-de p.en, body.lang-de li.en,
body.lang-de h1.en, body.lang-de h2.en, body.lang-de h3.en,
body.lang-de h4.en, body.lang-de section.en { display: none; }

body.lang-de #TOC .en { display: none; }
body.lang-de #TOC .de { display: inline; }
#TOC .de { display: none; }
#TOC .en { display: inline; }

@media print {
  .tocify, .lang-toggle, .copy-btn { display: none; }
}

/* ========== MOBILE RESPONSIVE ========== */
@media (max-width: 768px) {
  body { font-size: 14px; line-height: 1.5; }
  h1 { font-size: 1.5rem; }
  h2 { font-size: 1.3rem; }
  h3 { font-size: 1.1rem; }
  .lang-toggle { top: 5px; right: 10px; padding: 5px 8px; }
  .lang-toggle button { padding: 4px 10px; font-size: 12px; }
  table { font-size: 12px; display: block; overflow-x: auto; white-space: nowrap; }
  th, td { padding: 6px 8px; }
  blockquote { padding: 10px 15px; margin: 0.5em 0; }
  pre { font-size: 11px; padding: 10px; }
  code { font-size: 11px; }
  img, .figure img { max-width: 100%; height: auto; }
}
</style>
```

```{=html}
<script>
$(document).ready(function() {
  var toggle = $('<div class="lang-toggle"><button id="btn-en" class="active">EN</button><button id="btn-de">DE</button></div>');
  $('body').append(toggle);

  var savedLang = localStorage.getItem('workshop-lang');
  var browserLang = navigator.language.substring(0, 2);
  var defaultLang = savedLang || (browserLang === 'de' ? 'de' : 'en');

  function setLanguage(lang) {
    $('body').removeClass('lang-en lang-de').addClass('lang-' + lang);
    $('#btn-en').toggleClass('active', lang === 'en');
    $('#btn-de').toggleClass('active', lang === 'de');
    localStorage.setItem('workshop-lang', lang);
  }

  if (defaultLang === 'de') {
    setLanguage('de');
  }

  $('#btn-en').click(function() { setLanguage('en'); });
  $('#btn-de').click(function() { setLanguage('de'); });

  $('pre').each(function() {
    var pre = $(this);
    var btn = $('<button class="copy-btn">Copy</button>');

    btn.click(function() {
      var code = pre.find('code');
      var text = code.length ? code.text() : pre.text();

      function showSuccess() {
        btn.text('Copied!').addClass('copied');
        setTimeout(function() {
          btn.text('Copy').removeClass('copied');
        }, 2000);
      }

      function fallbackCopy() {
        var textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showSuccess();
        } catch(e) {
          btn.text('Failed');
        }
        document.body.removeChild(textarea);
      }

      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(showSuccess).catch(fallbackCopy);
      } else {
        fallbackCopy();
      }
    });

    pre.css('position', 'relative').append(btn);
  });
});
</script>
```

<div class="solution-notice">
<span class="en">SOLUTIONS - For instructors only!</span>
<span class="de">LOSUNGEN - Nur fur Lehrende!</span>
</div>

---

# <span class="en">Setup: Loading Day 1 Functions</span><span class="de">Setup: Funktionen von Tag 1 laden</span>

<div class="recap-box">
<p class="en">Before starting Day 2, we need to reload all the functions and data from Day 1. Run this entire setup block first!</p>
<p class="de">Bevor wir Tag 2 beginnen, mussen wir alle Funktionen und Daten von Tag 1 neu laden. Fuhre zuerst diesen gesamten Setup-Block aus!</p>
</div>

```{r day1-recap}
# ===== DAY 1 RECAP: Run this first! =====
# ===== TAG 1 ZUSAMMENFASSUNG: Zuerst ausfuhren! =====

library(dplyr)
library(ggplot2)

# Load the data / Daten laden
header <- read.csv("../data/austria_header.csv")
species <- read.csv("../data/austria_species.csv")

# Distance function / Distanzfunktion
calc_distance <- function(x1, y1, x2, y2) {
  sqrt((x2 - x1)^2 + (y2 - y1)^2)
}

# Nearest-neighbour walk / Nearest-Neighbour-Walk
nn_walk <- function(header_data, start_idx = NULL) {
  n <- nrow(header_data)
  if (is.null(start_idx)) {
    start_idx <- sample(1:n, 1)
  }

  visited <- rep(FALSE, n)
  visit_order <- numeric(n)
  current <- start_idx

  for (i in 1:n) {
    visited[current] <- TRUE
    visit_order[i] <- header_data$PlotObservationID[current]

    if (i < n) {
      distances <- calc_distance(
        header_data$Longitude[current],
        header_data$Latitude[current],
        header_data$Longitude,
        header_data$Latitude
      )
      distances[visited] <- Inf
      current <- which.min(distances)
    }
  }

  return(visit_order)
}

# Accumulation function / Akkumulationsfunktion
build_accumulation <- function(species_data, plot_order, status_filter = NULL) {
  if (!is.null(status_filter)) {
    species_data <- species_data %>% filter(STATUS == status_filter)
  }

  found <- c()
  accum <- numeric(length(plot_order))

  for (i in seq_along(plot_order)) {
    plot_spp <- species_data %>%
      filter(PlotObservationID == plot_order[i]) %>%
      pull(WFO_TAXON) %>%
      unique()

    new_spp <- setdiff(plot_spp, found)
    found <- c(found, new_spp)
    accum[i] <- length(found)
  }

  return(accum)
}

# Saturation function / Sattigungsfunktion
find_saturation <- function(curve, threshold = 0.8) {
  total <- max(curve)
  target <- total * threshold
  which(curve >= target)[1]
}

cat("Setup complete! All functions loaded.\n")
cat("Setup abgeschlossen! Alle Funktionen geladen.\n")
```

---

# <span class="en">Part 5: Advanced Analysis - Uncertainty & Publication</span><span class="de">Teil 5: Fortgeschrittene Analyse - Unsicherheit & Publikation</span>

## <span class="en">Exercise 16: Multiple Seeds - Quantifying Uncertainty</span><span class="de">Ubung 16: Mehrere Seeds - Unsicherheit quantifizieren</span>

<p class="en">A single nearest-neighbour walk depends on where you start. By running many walks from different starting points, we can quantify this uncertainty.</p>
<p class="de">Ein einzelner Nearest-Neighbour-Walk hangt davon ab, wo man startet. Durch viele Walks von verschiedenen Startpunkten konnen wir diese Unsicherheit quantifizieren.</p>

### <span class="en">16a: Run from multiple starting points</span><span class="de">16a: Von mehreren Startpunkten starten</span>

```{r}
# Solution / Losung

n_seeds <- 20
sample_size <- 150

set.seed(42)
sample_ids <- sample(unique(header$PlotObservationID), sample_size)
sample_header <- header %>% filter(PlotObservationID %in% sample_ids)
sample_species <- species %>% filter(PlotObservationID %in% sample_ids)

native_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)
alien_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)

cat("Running", n_seeds, "seeds...\n")
for (seed in 1:n_seeds) {
  nn_order <- nn_walk(sample_header, start_idx = seed)
  native_runs[seed, ] <- build_accumulation(sample_species, nn_order, "native")
  alien_runs[seed, ] <- build_accumulation(sample_species, nn_order, "neo")

  if (seed %% 5 == 0) cat("  Completed seed", seed, "\n")
}

cat("Done!\n")
```

### <span class="en">16b: Calculate summary statistics</span><span class="de">16b: Zusammenfassende Statistiken berechnen</span>

```{r}
# Solution / Losung

native_mean <- apply(native_runs, 2, mean)
native_lower <- apply(native_runs, 2, function(x) quantile(x, 0.025))
native_upper <- apply(native_runs, 2, function(x) quantile(x, 0.975))

alien_mean <- apply(alien_runs, 2, mean)
alien_lower <- apply(alien_runs, 2, function(x) quantile(x, 0.025))
alien_upper <- apply(alien_runs, 2, function(x) quantile(x, 0.975))

midpoint <- sample_size %/% 2
native_cv <- round(100 * sd(native_runs[, midpoint]) / mean(native_runs[, midpoint]), 1)
alien_cv <- round(100 * sd(alien_runs[, midpoint]) / mean(alien_runs[, midpoint]), 1)

print(paste("Variation at", midpoint, "plots:"))
print(paste("  Native CV:", native_cv, "%"))
print(paste("  Alien CV:", alien_cv, "%"))
```

### <span class="en">16c: Plot with uncertainty bands</span><span class="de">16c: Plotte mit Unsicherheitsbandern</span>

```{r}
# Solution / Losung

summary_data <- data.frame(
  plots = rep(1:sample_size, 2),
  mean = c(native_mean, alien_mean),
  lower = c(native_lower, alien_lower),
  upper = c(native_upper, alien_upper),
  status = rep(c("Native", "Alien"), each = sample_size)
)

ggplot(summary_data, aes(x = plots)) +
  geom_ribbon(aes(ymin = lower, ymax = upper, fill = status), alpha = 0.3) +
  geom_line(aes(y = mean, color = status), linewidth = 1.2) +
  scale_color_manual(values = c("Native" = "darkgreen", "Alien" = "red")) +
  scale_fill_manual(values = c("Native" = "darkgreen", "Alien" = "red")) +
  labs(
    title = "Species Accumulation with Uncertainty",
    subtitle = paste(n_seeds, "starting points - shaded area = 95% CI"),
    x = "Plots Sampled (Nearest-Neighbour Order)",
    y = "Cumulative Species",
    color = "", fill = ""
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

---

## <span class="en">Exercise 17: Comparing Curve Shapes</span><span class="de">Ubung 17: Kurvenformen vergleichen</span>

<p class="en">Beyond total species counts, the *shape* of accumulation curves reveals ecological patterns. Faster saturation suggests more even spatial distribution.</p>
<p class="de">Uber die Gesamtartenzahl hinaus zeigt die *Form* der Akkumulationskurven okologische Muster. Schnellere Sattigung deutet auf gleichmassigere raumliche Verteilung hin.</p>

### <span class="en">17a: Saturation point comparison</span><span class="de">17a: Sattigungspunkt-Vergleich</span>

```{r}
# Solution / Losung

native_sat <- apply(native_runs, 1, find_saturation, threshold = 0.8)
alien_sat <- apply(alien_runs, 1, find_saturation, threshold = 0.8)

native_sat_pct <- 100 * native_sat / sample_size
alien_sat_pct <- 100 * alien_sat / sample_size

print("Plots needed to reach 80% of species:")
print(paste("  Native:", round(mean(native_sat_pct)), "% (SD:", round(sd(native_sat_pct), 1), ")"))
print(paste("  Alien:", round(mean(alien_sat_pct)), "% (SD:", round(sd(alien_sat_pct), 1), ")"))

sat_data <- data.frame(
  saturation_pct = c(native_sat_pct, alien_sat_pct),
  status = rep(c("Native", "Alien"), each = n_seeds)
)

ggplot(sat_data, aes(x = status, y = saturation_pct, fill = status)) +
  geom_boxplot() +
  scale_fill_manual(values = c("Native" = "darkgreen", "Alien" = "red")) +
  labs(
    title = "Saturation Speed Comparison",
    subtitle = "% of plots needed to find 80% of species",
    y = "% of Plots Needed",
    x = ""
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

### <span class="en">17b: Slope ratio analysis</span><span class="de">17b: Steigungsverhaltnis-Analyse</span>

```{r}
# Solution / Losung

calc_slope_ratio <- function(curve) {
  n <- length(curve)

  early_end <- round(n * 0.2)
  early_slope <- (curve[early_end] - curve[1]) / early_end

  late_start <- round(n * 0.8)
  late_slope <- (curve[n] - curve[late_start]) / (n - late_start)

  if (late_slope > 0) {
    return(early_slope / late_slope)
  } else {
    return(NA)
  }
}

native_ratios <- apply(native_runs, 1, calc_slope_ratio)
alien_ratios <- apply(alien_runs, 1, calc_slope_ratio)

print("Slope ratio (early/late) - higher = faster saturation:")
print(paste("  Native:", round(mean(native_ratios, na.rm = TRUE), 1)))
print(paste("  Alien:", round(mean(alien_ratios, na.rm = TRUE), 1)))
```

---

## <span class="en">Exercise 18: Geographic Patterns</span><span class="de">Ubung 18: Geografische Muster</span>

<p class="en">Does starting location affect what you find? This exercise explores whether invasion patterns vary across Austria's geography.</p>
<p class="de">Beeinflusst der Startort, was man findet? Diese Ubung untersucht, ob Invasionsmuster uber Osterreichs Geografie variieren.</p>

### <span class="en">18a: Does starting location affect results?</span><span class="de">18a: Beeinflusst der Startort die Ergebnisse?</span>

```{r}
# Solution / Losung

n_map_seeds <- 30
checkpoint <- 75

seed_results <- data.frame(
  seed_idx = 1:n_map_seeds,
  seed_lon = numeric(n_map_seeds),
  seed_lat = numeric(n_map_seeds),
  native_count = numeric(n_map_seeds),
  alien_count = numeric(n_map_seeds)
)

for (i in 1:n_map_seeds) {
  seed_results$seed_lon[i] <- sample_header$Longitude[i]
  seed_results$seed_lat[i] <- sample_header$Latitude[i]

  nn_order <- nn_walk(sample_header, start_idx = i)

  native_curve <- build_accumulation(sample_species, nn_order, "native")
  alien_curve <- build_accumulation(sample_species, nn_order, "neo")

  seed_results$native_count[i] <- native_curve[min(checkpoint, length(native_curve))]
  seed_results$alien_count[i] <- alien_curve[min(checkpoint, length(alien_curve))]
}

seed_results$alien_prop <- seed_results$alien_count /
  (seed_results$native_count + seed_results$alien_count)

ggplot(seed_results, aes(x = seed_lon, y = seed_lat, color = alien_prop)) +
  geom_point(size = 3) +
  scale_color_gradient2(
    low = "darkgreen",
    mid = "yellow",
    high = "red",
    midpoint = mean(seed_results$alien_prop),
    name = "Alien\nproportion"
  ) +
  coord_quickmap() +
  labs(
    title = "How Starting Location Affects Alien Detection",
    subtitle = paste("Alien proportion after", checkpoint, "plots"),
    x = "Longitude",
    y = "Latitude"
  ) +
  theme_minimal()
```

### <span class="en">18b: Correlation with geography</span><span class="de">18b: Korrelation mit Geografie</span>

```{r}
# Solution / Losung

cor_lon <- cor(seed_results$seed_lon, seed_results$alien_prop)
cor_lat <- cor(seed_results$seed_lat, seed_results$alien_prop)

print(paste("Correlation with longitude:", round(cor_lon, 3)))
print(paste("Correlation with latitude:", round(cor_lat, 3)))

# Interpretation
if (abs(cor_lon) > 0.3 || abs(cor_lat) > 0.3) {
  print("There appears to be a geographic pattern in alien distribution!")
} else {
  print("Alien distribution appears relatively uniform across the sample area.")
}
```

---

## <span class="en">Exercise 19: Full Analysis & Publication Figure</span><span class="de">Ubung 19: Vollstandige Analyse & Publikationsabbildung</span>

<p class="en">Now let's run a complete, publication-quality analysis with a larger sample and more seeds.</p>
<p class="de">Jetzt fuhren wir eine vollstandige, publikationsreife Analyse mit grosserer Stichprobe und mehr Seeds durch.</p>

### <span class="en">19a: Run the complete analysis</span><span class="de">19a: Fuhre die komplette Analyse aus</span>

```{r}
# Solution / Losung

n_seeds <- 30
sample_size <- 250

set.seed(2024)
sample_ids <- sample(unique(header$PlotObservationID), sample_size)
sample_header <- header %>% filter(PlotObservationID %in% sample_ids)
sample_species <- species %>% filter(PlotObservationID %in% sample_ids)

native_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)
alien_runs <- matrix(NA, nrow = n_seeds, ncol = sample_size)

cat("Running full analysis...\n")
for (seed in 1:n_seeds) {
  nn_order <- nn_walk(sample_header, start_idx = seed)
  native_runs[seed, ] <- build_accumulation(sample_species, nn_order, "native")
  alien_runs[seed, ] <- build_accumulation(sample_species, nn_order, "neo")
  if (seed %% 10 == 0) cat("  Completed", seed, "of", n_seeds, "\n")
}
cat("Done!\n")

results <- data.frame(
  plots = rep(1:sample_size, 2),
  mean = c(apply(native_runs, 2, mean), apply(alien_runs, 2, mean)),
  lower = c(apply(native_runs, 2, function(x) quantile(x, 0.025)),
            apply(alien_runs, 2, function(x) quantile(x, 0.025))),
  upper = c(apply(native_runs, 2, function(x) quantile(x, 0.975)),
            apply(alien_runs, 2, function(x) quantile(x, 0.975))),
  status = rep(c("Native", "Alien"), each = sample_size)
)
```

### <span class="en">19b: Create final publication plot</span><span class="de">19b: Erstelle finalen Publikationsplot</span>

```{r}
# Solution / Losung

final_plot <- ggplot(results, aes(x = plots)) +
  geom_ribbon(aes(ymin = lower, ymax = upper, fill = status), alpha = 0.25) +
  geom_line(aes(y = mean, color = status), linewidth = 1.3) +
  scale_color_manual(
    values = c("Native" = "#228B22", "Alien" = "#DC143C"),
    name = ""
  ) +
  scale_fill_manual(
    values = c("Native" = "#228B22", "Alien" = "#DC143C"),
    name = ""
  ) +
  labs(
    title = "Species Accumulation: Native vs Alien Plants",
    subtitle = paste0("Nearest-neighbour sampling from ", n_seeds,
                      " starting points (95% CI shown)"),
    x = "Number of Plots Sampled",
    y = "Cumulative Species Count",
    caption = "Data: Austrian vegetation plots"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = c(0.85, 0.2),
    legend.background = element_rect(fill = "white", color = "gray80"),
    plot.title = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )

print(final_plot)

# Save to file (uncomment to run)
# ggsave("austria_accumulation_final.png", final_plot, width = 10, height = 7, dpi = 300)
```

---

## <span class="en">Exercise 20: Results Summary & Conclusions</span><span class="de">Ubung 20: Ergebniszusammenfassung & Schlussfolgerungen</span>

<p class="en">The final exercise: synthesize your results and draw ecological conclusions.</p>
<p class="de">Die letzte Ubung: Fasse deine Ergebnisse zusammen und ziehe okologische Schlussfolgerungen.</p>

### <span class="en">20a: Generate summary statistics</span><span class="de">20a: Zusammenfassende Statistiken erstellen</span>

```{r}
# Solution / Losung

cat("\n===== RESULTS SUMMARY =====\n\n")

cat("Species found:\n")
cat("  Native:", round(mean(native_runs[, sample_size])),
    "(range:", min(native_runs[, sample_size]), "-", max(native_runs[, sample_size]), ")\n")
cat("  Alien:", round(mean(alien_runs[, sample_size])),
    "(range:", min(alien_runs[, sample_size]), "-", max(alien_runs[, sample_size]), ")\n\n")

native_sat <- apply(native_runs, 1, find_saturation, threshold = 0.8)
alien_sat <- apply(alien_runs, 1, find_saturation, threshold = 0.8)

cat("Plots to reach 80% of species:\n")
cat("  Native:", round(mean(native_sat)), "plots (",
    round(100*mean(native_sat)/sample_size), "%)\n")
cat("  Alien:", round(mean(alien_sat)), "plots (",
    round(100*mean(alien_sat)/sample_size), "%)\n\n")

cat("Variation between starting points (CV at 100 plots):\n")
cat("  Native:", round(100 * sd(native_runs[,100]) / mean(native_runs[,100]), 1), "%\n")
cat("  Alien:", round(100 * sd(alien_runs[,100]) / mean(alien_runs[,100]), 1), "%\n\n")
```

### <span class="en">20b: Draw conclusions</span><span class="de">20b: Schlussfolgerungen ziehen</span>

```{r}
# Solution / Losung

cat("===== ECOLOGICAL CONCLUSIONS =====\n\n")

if (mean(native_sat) < mean(alien_sat)) {
  cat("FINDING: Native species saturate FASTER than aliens.\n\n")
  cat("INTERPRETATION:\n")
  cat("- Native species are more evenly distributed across the landscape\n")
  cat("- Alien species are more clustered/patchy in their distribution\n")
  cat("- This is consistent with invasion biology theory:\n")
  cat("  aliens often establish in disturbed areas (roads, urban, agriculture)\n")
  cat("  which are spatially clustered\n\n")
} else {
  cat("FINDING: Alien species saturate FASTER than natives.\n\n")
  cat("INTERPRETATION:\n")
  cat("- This is unexpected and suggests aliens may be more widespread\n")
  cat("- Possible explanations:\n")
  cat("  1. Advanced invasion stage in this region\n")
  cat("  2. Many 'naturalized' aliens now broadly distributed\n")
  cat("  3. Sample bias toward accessible (more invaded) areas\n\n")
}

cat("METHODOLOGICAL INSIGHTS:\n")
cat("- Starting point matters:", round(100 * sd(native_runs[,100]) / mean(native_runs[,100]), 1),
    "% variation in native counts\n")
cat("- Multiple seeds are essential for robust conclusions\n")
cat("- Spatial sampling order (NN walk) reveals patterns that random order would miss\n\n")

cat("===== WORKSHOP COMPLETE! =====\n")
cat("You have learned:\n")
cat("1. R basics: vectors, dataframes, functions\n")
cat("2. Data manipulation with dplyr\n")
cat("3. Visualization with ggplot2\n")
cat("4. Spatial algorithms (nearest-neighbour)\n")
cat("5. Uncertainty quantification\n")
cat("6. Scientific interpretation of results\n")
```

---
